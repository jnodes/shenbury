<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ru Kiln Ceramics & Chinese Imperial Artifacts | Shenbury 神堡</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'nonce-RUNTIME_NONCE' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: https:;
        connect-src 'self' https://mainnet.infura.io https://sepolia.infura.io wss://mainnet.infura.io wss://sepolia.infura.io;
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
        upgrade-insecure-requests;
    ">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Enhanced SEO Meta Tags -->
    <meta name="description" content="Shenbury 神堡 - The Art of Provenance. Authenticated Ru kiln ceramics from Northern Song Dynasty, Ming Jingtai cloisonné, and Yuan blue-glazed porcelain. Museum-quality Chinese artifacts with ERC-404 fractional ownership.">
    <meta name="keywords" content="Shenbury, 神堡, Ru kiln, Ru ware, Song Dynasty, Chinese ceramics, 汝窯, 宋代瓷器, Ming Dynasty, Jingtai cloisonné, 景泰藍, Yuan Dynasty, Jilan glaze, 霽藍釉, auction, ERC-404, NFT, provenance, Emperor Huizong">
    
    <!-- Open Graph for Social -->
    <meta property="og:title" content="Shenbury 神堡 | $35M+ Chinese Imperial Ceramics Collection">
    <meta property="og:description" content="The Art of Provenance. Own fractional shares of museum-quality Ru kiln ceramics and imperial Chinese artifacts from Song, Yuan, and Ming dynasties.">
    <meta property="og:image" content="/assets/images/relics/001-song-ru-washer/main.jpg">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://shenbury.com">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Shenbury 神堡 - Rare Ru Kiln Ceramics at Auction">
    <meta name="twitter:description" content="Exceptional Northern Song Ru ware, Ming cloisonné, and Yuan porcelain. Experience the pinnacle of Chinese ceramic achievement.">
    <meta name="twitter:image" content="/assets/images/relics/001-song-ru-washer/main.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="alternate icon" href="/favicon.ico">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ArtGallery",
      "name": "Shenbury 神堡",
      "description": "The Art of Provenance - Web3 auction house specializing in imperial Chinese ceramics from Song, Yuan, and Ming dynasties",
      "url": "https://shenbury.com",
      "slogan": "The Art of Provenance"
    }
    </script>
    
    <link rel="canonical" href="https://shenbury.com">
    
    <!-- External Scripts with SRI -->
    <script 
        src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"
        integrity="sha384-I0eNxG6bQZWZGGvaHrnQ2LDKxCfU7tlc4I5DS3I1bE5kiEGErL8Lz7lsqMXVqmqH"
        crossorigin="anonymous"></script>
    
    <!-- DOMPurify for sanitization -->
    <script 
        src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" 
        integrity="sha512-H+rglffZ6f5gF7UJgvH4Naa+fGCgjrHKMgoFOGmcPTRwR6oILo5R+gtzNrpDp7iMV3udbymBVjkeZGNz1Em4rQ==" 
        crossorigin="anonymous"></script>
    
    <style>
        /* Previous styles remain the same, adding only security-related styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #000000;
            --secondary: #ffffff;
            --accent: #c9302c;
            --gray-light: #f8f8f8;
            --gray-medium: #e5e5e5;
            --gray-dark: #666666;
            --text-primary: #000000;
            --text-secondary: #666666;
            --hover: #c9302c;
            --shadow: rgba(0, 0, 0, 0.08);
            --font-primary: 'Cormorant Garamond', serif;
            --font-secondary: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --success: #28a745;
            --error: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }
        
        body {
            font-family: var(--font-secondary);
            background: var(--secondary);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 300;
        }
        
        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-primary);
            font-weight: 300;
            letter-spacing: -0.02em;
        }
        
        /* Loading State */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader {
            width: 40px;
            height: 40px;
            border: 2px solid var(--gray-medium);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Header */
        header {
            background: var(--secondary);
            border-bottom: 1px solid var(--gray-medium);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 0 2rem;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            cursor: pointer;
        }
        
        .logo-text {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }
        
        .logo-chinese {
            font-family: var(--font-primary);
            font-size: 1.25rem;
            font-weight: 400;
        }
        
        .logo-english {
            font-family: var(--font-primary);
            font-size: 1.75rem;
            font-weight: 400;
            letter-spacing: 0.05em;
        }
        
        .logo-tagline {
            font-size: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--text-secondary);
            margin-top: 0.25rem;
            font-family: var(--font-secondary);
        }
        
        .nav-center {
            display: flex;
            gap: 3rem;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .nav-center a {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: color 0.3s ease;
            position: relative;
        }
        
        .nav-center a:hover {
            color: var(--hover);
        }
        
        .nav-center a.active::after {
            content: '';
            position: absolute;
            bottom: -29px;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--accent);
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .wallet-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
        }
        
        .erc404-balance {
            background: var(--gray-light);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .connect-wallet {
            background: var(--primary);
            color: var(--secondary);
            border: 1px solid var(--primary);
            padding: 0.75rem 2rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 400;
        }
        
        .connect-wallet:hover {
            background: transparent;
            color: var(--primary);
        }
        
        .connect-wallet.connected {
            background: transparent;
            color: var(--primary);
        }
        
        /* Hero Section */
        .hero {
            height: 500px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url('/assets/images/hero-bg.jpg');
            background-size: cover;
            background-position: center;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4), rgba(0,0,0,0.6));
            z-index: 1;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
            max-width: 800px;
            padding: 0 2rem;
            animation: heroFadeIn 1s ease;
        }
        
        @keyframes heroFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hero h1 {
            font-size: 3.5rem;
            font-weight: 300;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
            font-family: var(--font-primary);
        }
        
        .hero p {
            font-size: 1.25rem;
            font-weight: 300;
            opacity: 0.9;
            margin-bottom: 2rem;
            font-family: var(--font-secondary);
        }
        
        .hero-cta {
            background: var(--accent);
            color: white;
            border: none;
            padding: 1rem 3rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .hero-cta:hover {
            background: #a02622;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(201, 48, 44, 0.3);
        }
        
        /* Auction Header */
        .auction-header {
            max-width: 1400px;
            margin: 4rem auto 2rem;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: baseline;
        }
        
        .auction-header h2 {
            font-size: 2rem;
            font-weight: 300;
            font-family: var(--font-primary);
        }
        
        .auction-stats {
            display: flex;
            gap: 3rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            color: var(--text-primary);
            display: block;
            font-weight: 400;
        }
        
        /* Filter Bar */
        .filter-bar {
            max-width: 1400px;
            margin: 0 auto 3rem;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--gray-medium);
            border-bottom: 1px solid var(--gray-medium);
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        
        .dynasty-filters {
            display: flex;
            gap: 2rem;
        }
        
        .dynasty-filter {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .dynasty-filter:hover,
        .dynasty-filter.active {
            color: var(--text-primary);
        }
        
        .dynasty-filter.active::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--accent);
        }
        
        .sort-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .sort-select {
            border: 1px solid var(--gray-medium);
            padding: 0.5rem 1rem;
            background: white;
            cursor: pointer;
            outline: none;
        }
        
        .sort-select:focus {
            border-color: var(--text-primary);
        }
        
        /* Artifact Grid - Masonry Layout */
        .artifacts-grid {
            max-width: 1400px;
            margin: 0 auto 4rem;
            padding: 0 2rem;
            column-count: 4;
            column-gap: 3rem;
        }
        
        .artifact-card {
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            animation: cardFadeIn 0.5s ease forwards;
            break-inside: avoid;
            display: inline-block;
            width: 100%;
            margin-bottom: 3rem;
        }
        
        .artifact-card:nth-child(1) { animation-delay: 0.1s; }
        .artifact-card:nth-child(2) { animation-delay: 0.2s; }
        .artifact-card:nth-child(3) { animation-delay: 0.3s; }
        .artifact-card:nth-child(4) { animation-delay: 0.4s; }
        .artifact-card:nth-child(5) { animation-delay: 0.5s; }
        
        @keyframes cardFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(20px);
            }
        }
        
        .artifact-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px var(--shadow);
        }
        
        .artifact-image-container {
            position: relative;
            background: var(--gray-light);
            overflow: hidden;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Dynamic aspect ratios - Natural height for masonry */
        .artifact-image-container.portrait,
        .artifact-image-container.landscape,
        .artifact-image-container.square {
            padding-bottom: 0; /* Natural height */
        }
        
        .artifact-image {
            position: relative;
            width: 100%;
            height: auto;
            display: block;
            object-fit: contain;
            background-color: #f8f8f8;
            transition: transform 0.5s ease;
        }
        
        /* Image loading states */
        .artifact-image.loading {
            opacity: 0;
        }
        
        .artifact-image.loaded {
            opacity: 1;
            animation: imageReveal 0.5s ease;
        }
        
        @keyframes imageReveal {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .artifact-card:hover .artifact-image {
            transform: scale(1.05);
        }
        
        .artifact-info {
            padding: 0 0.5rem;
        }
        
        .artifact-lot {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }
        
        .artifact-title {
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
            font-weight: 400;
            line-height: 1.4;
            font-family: var(--font-primary);
        }
        
        .artifact-dynasty {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .artifact-estimate {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .artifact-bid {
            font-size: 1.125rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
        }
        
        .artifact-erc404 {
            background: var(--gray-light);
            padding: 0.75rem;
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            border-radius: 4px;
        }
        
        .artifact-erc404 strong {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            max-width: 1200px;
            margin: 2rem auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close-modal {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            border-radius: 50%;
            box-shadow: 0 2px 10px var(--shadow);
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
            background: var(--gray-light);
        }
        
        .modal-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 600px;
        }
        
        .modal-image-section {
            background: var(--gray-light);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 2rem;
        }
        
        /* Image gallery dots */
        .image-gallery-dots {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
        }
        
        .gallery-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .gallery-dot.active {
            background: var(--accent);
            width: 24px;
            border-radius: 4px;
        }
        
        .modal-info-section {
            padding: 3rem;
            overflow-y: auto;
            max-height: 90vh;
        }
        
        .modal-lot-number {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
        }
        
        .modal-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            line-height: 1.3;
            font-family: var(--font-primary);
        }
        
        .modal-dynasty {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        .modal-description {
            font-size: 1rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            color: var(--text-secondary);
        }
        
        .detail-sections {
            border-top: 1px solid var(--gray-medium);
            padding-top: 2rem;
            margin-bottom: 2rem;
        }
        
        .detail-section {
            margin-bottom: 1.5rem;
        }
        
        .detail-section h4 {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            font-weight: 400;
        }
        
        .detail-section p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
        }
        
        .bidding-section {
            border-top: 1px solid var(--gray-medium);
            padding-top: 2rem;
        }
        
        .current-bid-info {
            margin-bottom: 2rem;
        }
        
        .current-bid-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .current-bid-amount {
            font-size: 2rem;
            font-weight: 400;
            margin: 0.5rem 0;
            font-family: var(--font-primary);
        }
        
        .bid-count {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .bid-options {
            display: grid;
            gap: 2rem;
        }
        
        .bid-option {
            border: 1px solid var(--gray-medium);
            padding: 1.5rem;
            border-radius: 4px;
            transition: border-color 0.3s ease;
        }
        
        .bid-option:hover {
            border-color: var(--text-primary);
        }
        
        .bid-option h5 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            font-weight: 400;
        }
        
        .bid-option p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .bid-input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .bid-input {
            flex: 1;
            border: 1px solid var(--gray-medium);
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border-radius: 4px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .bid-input:focus {
            border-color: var(--text-primary);
        }
        
        .bid-input.error {
            border-color: var(--error);
        }
        
        .input-error {
            color: var(--error);
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .input-error.show {
            display: block;
        }
        
        .bid-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .bid-button:hover:not(:disabled) {
            background: var(--hover);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .bid-button:disabled {
            background: var(--gray-medium);
            cursor: not-allowed;
            transform: none;
        }
        
        .bid-button.processing::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            to { left: 100%; }
        }
        
        .bid-button.secondary {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .bid-button.secondary:hover:not(:disabled) {
            background: var(--primary);
            color: white;
        }
        
        .erc404-info {
            background: var(--gray-light);
            padding: 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            border-radius: 4px;
            line-height: 1.6;
        }
        
        /* Confirmation Modal */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .confirmation-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            animation: confirmationSlideIn 0.3s ease;
        }
        
        @keyframes confirmationSlideIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .confirmation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .confirmation-header h3 {
            font-size: 1.5rem;
            font-weight: 400;
        }
        
        .confirmation-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s;
        }
        
        .confirmation-close:hover {
            color: var(--text-primary);
        }
        
        .confirmation-body {
            margin-bottom: 2rem;
        }
        
        .confirmation-details {
            background: var(--gray-light);
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .confirmation-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .confirmation-row:last-child {
            margin-bottom: 0;
            padding-top: 0.5rem;
            border-top: 1px solid var(--gray-medium);
            font-weight: 500;
        }
        
        .gas-estimate {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 1rem;
        }
        
        .confirmation-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .btn-cancel {
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--gray-medium);
            padding: 0.75rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-cancel:hover {
            border-color: var(--text-primary);
        }
        
        .btn-confirm {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 0.875rem;
        }
        
        .btn-confirm:hover {
            background: var(--hover);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--primary);
            color: white;
            padding: 1rem 2rem;
            border-radius: 4px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 3000;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: var(--success);
        }
        
        .toast.error {
            background: var(--error);
        }
        
        .toast.info {
            background: var(--info);
        }
        
        .toast.warning {
            background: var(--warning);
            color: #212529;
        }
        
        .toast-icon {
            font-size: 1.5rem;
        }
        
        /* Privacy Banner */
        .privacy-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary);
            color: white;
            padding: 1.5rem;
            display: none;
            z-index: 1500;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .privacy-banner.show {
            display: block;
        }
        
        .privacy-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }
        
        .privacy-text {
            flex: 1;
            font-size: 0.875rem;
        }
        
        .privacy-text a {
            color: white;
            text-decoration: underline;
        }
        
        .privacy-actions {
            display: flex;
            gap: 1rem;
        }
        
        .privacy-btn {
            padding: 0.5rem 1.5rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        
        .privacy-btn.accept {
            background: white;
            color: var(--primary);
        }
        
        .privacy-btn.accept:hover {
            background: var(--gray-light);
        }
        
        .privacy-btn.decline {
            background: transparent;
            color: white;
            border: 1px solid white;
        }
        
        .privacy-btn.decline:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Footer */
        footer {
            background: var(--primary);
            color: white;
            padding: 3rem 2rem;
            margin-top: 6rem;
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3rem;
        }
        
        .footer-section h4 {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            font-weight: 400;
            font-family: var(--font-secondary);
        }
        
        .footer-section a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 0.875rem;
            display: block;
            margin-bottom: 0.5rem;
            transition: color 0.3s ease;
        }
        
        .footer-section a:hover {
            color: white;
        }
        
        .footer-bottom {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .footer-logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .footer-logo .logo-text {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }
        
        .footer-logo .logo-chinese {
            font-family: var(--font-primary);
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .footer-logo .logo-english {
            font-family: var(--font-primary);
            font-size: 1.5rem;
            font-weight: 400;
            color: white;
        }
        
        /* Mobile Menu */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        .mobile-menu-toggle span {
            display: block;
            width: 25px;
            height: 2px;
            background: var(--primary);
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .nav-center {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .modal-body {
                grid-template-columns: 1fr;
            }
            
            .modal-image-section {
                height: 400px;
            }
            
            .artifacts-grid {
                column-count: 3;
                column-gap: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .logo-text {
                gap: 0.25rem;
            }
            
            .logo-chinese {
                font-size: 1rem;
            }
            
            .logo-english {
                font-size: 1.25rem;
            }
            
            .logo-tagline {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.125rem;
            }
            
            .artifacts-grid {
                column-count: 1;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .footer-logo {
                align-items: center;
            }
            
            .auction-header {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
            }
            
            .filter-bar {
                flex-direction: column;
                gap: 1rem;
            }
            
            .dynasty-filters {
                overflow-x: auto;
                width: 100%;
                justify-content: flex-start;
                padding-bottom: 0.5rem;
            }
            
            .modal-info-section {
                padding: 2rem;
            }
            
            .toast {
                left: 1rem;
                right: 1rem;
                bottom: 1rem;
            }
            
            .privacy-content {
                flex-direction: column;
                text-align: center;
            }
            
            .confirmation-content {
                margin: 1rem;
            }
        }
        
        /* Security-specific styles */
        .security-notice {
            background: var(--warning);
            color: #212529;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .security-notice-icon {
            font-size: 1.25rem;
        }
        
        /* Rate limit indicator */
        .rate-limit-warning {
            position: fixed;
            top: 100px;
            right: 2rem;
            background: var(--warning);
            color: #212529;
            padding: 1rem 1.5rem;
            border-radius: 4px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: none;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .rate-limit-warning.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="loader"></div>
    </div>

    <!-- Privacy Banner -->
    <div class="privacy-banner" id="privacy-banner">
        <div class="privacy-content">
            <div class="privacy-text">
                We use cookies and similar technologies to enhance your experience. By continuing, you agree to our 
                <a href="/privacy-policy" target="_blank">Privacy Policy</a> and 
                <a href="/terms" target="_blank">Terms of Service</a>.
            </div>
            <div class="privacy-actions">
                <button class="privacy-btn decline" onclick="declinePrivacy()">Decline</button>
                <button class="privacy-btn accept" onclick="acceptPrivacy()">Accept</button>
            </div>
        </div>
    </div>

    <!-- Rate Limit Warning -->
    <div class="rate-limit-warning" id="rate-limit-warning">
        <span class="security-notice-icon">⚠️</span>
        <span>Too many requests. Please wait before trying again.</span>
    </div>

    <header>
        <nav>
            <div class="logo" onclick="scrollToTop()">
                <div class="logo-text">
                    <div class="logo-chinese">神堡</div>
                    <div class="logo-english">Shenbury</div>
                </div>
                <div class="logo-tagline">The Art of Provenance</div>
            </div>
            <div class="nav-center">
                <a href="#auctions" class="active">Auctions</a>
                <a href="#private">Private Sales</a>
                <a href="#exhibitions">Exhibitions</a>
                <a href="#about">About</a>
            </div>
            <div class="nav-right">
                <div class="wallet-info">
                    <div class="erc404-balance" id="token-balance">
                        <span id="balance-amount">0</span> SHEN
                    </div>
                    <button class="connect-wallet" onclick="secureConnectWallet()">
                        <span id="wallet-text">Connect Wallet</span>
                    </button>
                </div>
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1>Exceptional Chinese Art</h1>
            <p>Song, Yuan & Ming Dynasty Masterpieces</p>
            <button class="hero-cta" onclick="scrollToAuctions()">View Current Auctions</button>
        </div>
    </section>

    <div class="auction-header" id="auctions">
        <h2>Featured Lots</h2>
        <div class="auction-stats">
            <div class="stat-item">
                <span class="stat-value" id="total-lots">0</span>
                <span>Total Lots</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="total-bids">0</span>
                <span>Active Bids</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="total-value">0</span>
                <span>Total Value (USD)</span>
            </div>
        </div>
    </div>

    <div class="filter-bar">
        <div class="dynasty-filters">
            <button class="dynasty-filter active" onclick="filterByDynasty('all')">All Dynasties</button>
            <button class="dynasty-filter" onclick="filterByDynasty('song')">Song Dynasty</button>
            <button class="dynasty-filter" onclick="filterByDynasty('yuan')">Yuan Dynasty</button>
            <button class="dynasty-filter" onclick="filterByDynasty('ming')">Ming Dynasty</button>
        </div>
        <div class="sort-controls">
            <span>Sort by:</span>
            <select class="sort-select" onchange="sortArtifacts(this.value)">
                <option value="lot">Lot Number</option>
                <option value="price-high">Price: High to Low</option>
                <option value="price-low">Price: Low to High</option>
                <option value="ending">Ending Soon</option>
            </select>
        </div>
    </div>

    <div class="artifacts-grid" id="artifacts-grid">
        <!-- Artifact cards will be dynamically generated -->
    </div>

    <!-- Artifact Detail Modal -->
    <div class="modal" id="artifact-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div class="modal-body">
                <div class="modal-image-section">
                    <img src="" alt="" class="modal-image" id="modal-image">
                    <div class="image-gallery-dots" id="gallery-dots"></div>
                </div>
                <div class="modal-info-section">
                    <div class="modal-lot-number" id="modal-lot">LOT 000</div>
                    <h2 class="modal-title" id="modal-title"></h2>
                    <p class="modal-dynasty" id="modal-dynasty"></p>
                    <p class="modal-description" id="modal-description"></p>
                    
                    <div class="detail-sections">
                        <div class="detail-section">
                            <h4>Provenance</h4>
                            <p id="modal-provenance"></p>
                        </div>
                        <div class="detail-section">
                            <h4>Condition</h4>
                            <p id="modal-condition"></p>
                        </div>
                        <div class="detail-section">
                            <h4>Dimensions</h4>
                            <p id="modal-dimensions"></p>
                        </div>
                        <div class="detail-section">
                            <h4>Literature</h4>
                            <p id="modal-literature"></p>
                        </div>
                        <div class="detail-section" id="technical-notes-section" style="display: none;">
                            <h4>Technical Notes</h4>
                            <p id="modal-technical-notes"></p>
                        </div>
                        <div class="detail-section" id="cultural-significance-section" style="display: none;">
                            <h4>Cultural Significance</h4>
                            <p id="modal-cultural-significance"></p>
                        </div>
                    </div>
                    
                    <div class="bidding-section">
                        <div class="current-bid-info">
                            <div class="current-bid-label">Current Bid</div>
                            <div class="current-bid-amount" id="modal-current-bid">$0</div>
                            <div class="bid-count" id="modal-bid-count">0 bids</div>
                        </div>
                        
                        <div class="bid-options">
                            <div class="bid-option">
                                <h5>Place Bid for Full Ownership</h5>
                                <p>Acquire complete ownership of this artifact as an NFT</p>
                                <div class="security-notice">
                                    <span class="security-notice-icon">🔒</span>
                                    <span>All transactions are secured and require wallet confirmation</span>
                                </div>
                                <div class="bid-input-group">
                                    <input type="number" class="bid-input" id="bid-amount" placeholder="Amount in USD" step="100000" min="0">
                                    <button class="bid-button" onclick="placeBidSecure()">Place Bid</button>
                                </div>
                                <div class="input-error" id="bid-error">Please enter a valid bid amount</div>
                                <p style="font-size: 0.75rem; margin-top: 0.5rem;">Minimum bid: $<span id="min-bid">0</span></p>
                            </div>
                            
                            <div class="bid-option">
                                <h5>Buy Fractional Ownership (ERC-404)</h5>
                                <p>Purchase SHEN tokens for partial ownership. 10,000 SHEN = 1 full NFT</p>
                                <div class="security-notice">
                                    <span class="security-notice-icon">🔒</span>
                                    <span>Smart contract audited by CertiK</span>
                                </div>
                                <div class="bid-input-group">
                                    <input type="number" class="bid-input" id="token-amount" placeholder="Number of SHEN tokens" step="100" min="100">
                                    <button class="bid-button secondary" onclick="buyTokensSecure()">Buy Tokens</button>
                                </div>
                                <div class="input-error" id="token-error">Please enter a valid token amount</div>
                                <div class="erc404-info">
                                    <strong>Current Price:</strong> $100 per SHEN<br>
                                    <strong>Available:</strong> <span id="available-tokens">0</span> SHEN for this artifact<br>
                                    <strong>Your Holdings:</strong> <span id="user-artifact-tokens">0</span> SHEN<br>
                                    <div class="gas-estimate">Estimated gas: <span id="gas-estimate">0.001 ETH</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Confirmation Modal -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h3>Confirm Transaction</h3>
                <button class="confirmation-close" onclick="closeConfirmation()">&times;</button>
            </div>
            <div class="confirmation-body">
                <p id="confirmation-message">Please review and confirm your transaction details:</p>
                <div class="confirmation-details" id="confirmation-details">
                    <!-- Details will be dynamically inserted -->
                </div>
                <div class="gas-estimate">
                    Estimated gas fee: <span id="confirm-gas">0.001 ETH</span>
                </div>
            </div>
            <div class="confirmation-actions">
                <button class="btn-cancel" onclick="closeConfirmation()">Cancel</button>
                <button class="btn-confirm" id="btn-confirm-transaction" onclick="executeTransaction()">Confirm Transaction</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo">
                    <div class="logo-text">
                        <div class="logo-chinese">神堡</div>
                        <div class="logo-english">Shenbury</div>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.875rem; margin-top: 0.5rem;">The Art of Provenance</p>
                </div>
            </div>
            <div class="footer-section">
                <h4>Services</h4>
                <a href="#">Auctions</a>
                <a href="#">Private Sales</a>
                <a href="#">Valuations</a>
                <a href="#">ERC-404 Guide</a>
            </div>
            <div class="footer-section">
                <h4>About</h4>
                <a href="#">Our Specialists</a>
                <a href="#">Press</a>
                <a href="#">Careers</a>
                <a href="#">Contact</a>
            </div>
            <div class="footer-section">
                <h4>Security & Legal</h4>
                <a href="/privacy-policy">Privacy Policy</a>
                <a href="/terms">Terms of Service</a>
                <a href="/security">Security</a>
                <a href="/audits">Smart Contract Audits</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Shenbury 神堡. All rights reserved. | The Art of Provenance | ERC-404 Powered by Ethereum</p>
        </div>
    </footer>

    <script>
        'use strict';
        
        // Configuration from environment (in production, use env variables)
        const CONFIG = {
            CHAIN_ID: 11155111, // Sepolia
            CHAIN_NAME: 'Sepolia Testnet',
            RPC_URL: 'https://sepolia.infura.io/v3/',
            BLOCK_EXPLORER: 'https://sepolia.etherscan.io/',
            CONTRACTS: {
                AUCTION: process.env.AUCTION_CONTRACT_ADDRESS || "0x0000000000000000000000000000000000000000",
                ERC404: process.env.ERC404_CONTRACT_ADDRESS || "0x0000000000000000000000000000000000000000"
            }
        };
        
        // Security utilities
        const SecurityUtils = {
            // Input sanitization
            sanitizeNumber: function(value, min = 0, max = Number.MAX_SAFE_INTEGER) {
                const num = parseFloat(value);
                if (isNaN(num) || num < min || num > max) {
                    return null;
                }
                return num;
            },
            
            // HTML escaping
            escapeHtml: function(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },
            
            // Rate limiting
            rateLimiter: {
                attempts: new Map(),
                check: function(action, limit = 5, window = 60000) {
                    const key = `${action}-${userAccount || 'anonymous'}`;
                    const now = Date.now();
                    const attempts = this.attempts.get(key) || [];
                    const recent = attempts.filter(t => now - t < window);
                    
                    if (recent.length >= limit) {
                        showRateLimitWarning();
                        return false;
                    }
                    
                    recent.push(now);
                    this.attempts.set(key, recent);
                    return true;
                }
            },
            
            // Transaction state manager
            transactionManager: {
                pending: new Set(),
                isPending: function(id) {
                    return this.pending.has(id);
                },
                setPending: function(id, pending) {
                    if (pending) {
                        this.pending.add(id);
                    } else {
                        this.pending.delete(id);
                    }
                }
            }
        };
        
        // Enhanced artifact data
        const artifacts = [
            {
                id: 1,
                lotNumber: '001',
                title: 'AN EXCEPTIONALLY RARE RU KILN SUNFLOWER-FORM WASHER',
                chinese: '北宋 汝官窯天青釉葵花洗',
                dynasty: 'song',
                dynastyInfo: 'Northern Song Dynasty, 1086-1106',
                imageOrientation: 'landscape',
                images: [
                    '/assets/images/relics/001-song-ru-washer/main.jpg',
                    '/assets/images/relics/001-song-ru-washer/detail-1.jpg',
                    '/assets/images/relics/001-song-ru-washer/detail-2.jpg',
                    '/assets/images/relics/001-song-ru-washer/detail-3.jpg',
                    '/assets/images/relics/001-song-ru-washer/detail-4.jpg'
                ],
                thumbnail: '/assets/images/relics/001-song-ru-washer/main.jpg',
                description: 'This extraordinarily rare washer represents the pinnacle of Song ceramic achievement. The vessel is shaped like a six-part flower mouth with three tiny sesame nail marks on the bottom.',
                estimate: { low: 5000000, high: 8000000 },
                currentBid: 6000000,
                minBidIncrement: 100000,
                bidCount: 47,
                endTime: Date.now() + 86400000 * 7,
                provenance: 'Private Collection, Hong Kong\nFormed in the 1970s',
                condition: 'Excellent condition with characteristic ice-crackle throughout the glaze.',
                dimensions: 'Diameter: 14.6 cm\nBottom diameter: 9.6 cm\nHeight: 3.65 cm',
                literature: 'Compare a similar example in the Palace Museum, Beijing',
                technicalNotes: 'The glaze exhibits the characteristic "sky-blue" color achieved through reduction firing.',
                culturalSignificance: 'Ru kilns operated for only about 20 years (1086-1106) exclusively for the Northern Song court.',
                fractionalAvailable: 1000,
                tokenHolders: 125
            }
            // Additional artifacts would be loaded securely from API
        ];
        
        // Contract ABIs
        const ERC404_CONTRACT_ABI = [
            {
                "inputs": [],
                "name": "name",
                "outputs": [{"name": "", "type": "string"}],
                "type": "function"
            },
            {
                "inputs": [{"name": "owner", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            },
            {
                "inputs": [{"name": "to", "type": "address"}, {"name": "amount", "type": "uint256"}],
                "name": "transfer",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            }
        ];
        
        // Global state
        let provider;
        let signer;
        let userAccount;
        let auctionContract;
        let erc404Contract;
        let currentFilter = 'all';
        let currentSort = 'lot';
        let selectedArtifact = null;
        let currentImageIndex = 0;
        let pendingTransaction = null;
        
        // Check if running in demo mode
        const DEMO_MODE = !window.ethereum || CONFIG.CONTRACTS.AUCTION === "0x0000000000000000000000000000000000000000";
        
        // Initialize application
        async function init() {
            // Check privacy consent
            if (!localStorage.getItem('privacyAccepted')) {
                showPrivacyBanner();
            }
            
            hideLoading();
            await loadArtifacts(); // In production, load from secure API
            renderArtifacts();
            updateStats();
            startTimers();
            
            // Initialize Web3 if available
            if (typeof window.ethereum !== 'undefined') {
                provider = new ethers.BrowserProvider(window.ethereum);
                
                // Check if already connected
                try {
                    const accounts = await provider.listAccounts();
                    if (accounts.length > 0) {
                        userAccount = accounts[0].address;
                        signer = await provider.getSigner();
                        await updateWalletUI();
                        await checkNetwork();
                    }
                } catch (error) {
                    console.error('No accounts connected');
                }
                
                // Listen for account changes
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', () => window.location.reload());
            }
            
            // Show demo mode notification
            if (DEMO_MODE) {
                setTimeout(() => {
                    showToast('Running in Demo Mode - Connect wallet and deploy contracts for real transactions', 'info');
                }, 2000);
            }
        }
        
        // Load artifacts securely
        async function loadArtifacts() {
            // In production, this would be an authenticated API call
            // For now, using the hardcoded data
            return artifacts;
        }
        
        // Privacy banner functions
        function showPrivacyBanner() {
            document.getElementById('privacy-banner').classList.add('show');
        }
        
        function acceptPrivacy() {
            localStorage.setItem('privacyAccepted', 'true');
            document.getElementById('privacy-banner').classList.remove('show');
            showToast('Privacy preferences saved', 'success');
        }
        
        function declinePrivacy() {
            // In production, limit functionality for users who decline
            document.getElementById('privacy-banner').classList.remove('show');
            showToast('Some features may be limited without accepting cookies', 'warning');
        }
        
        // Rate limit warning
        function showRateLimitWarning() {
            const warning = document.getElementById('rate-limit-warning');
            warning.classList.add('show');
            setTimeout(() => {
                warning.classList.remove('show');
            }, 5000);
        }
        
        // Hide loading screen
        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 500);
        }
        
        // Secure wallet connection
        async function secureConnectWallet() {
            if (!SecurityUtils.rateLimiter.check('connect-wallet', 3, 60000)) {
                return;
            }
            
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request account access
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    userAccount = accounts[0];
                    
                    // Initialize ethers
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    
                    // Verify contracts if not in demo mode
                    if (!DEMO_MODE) {
                        await verifyContracts();
                    }
                    
                    updateWalletUI();
                    showToast('Wallet connected successfully!', 'success');
                    
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                    handleWalletError(error);
                }
            } else {
                showToast('Please install MetaMask to use this dApp', 'error');
                window.open('https://metamask.io/download/', '_blank');
            }
        }
        
        // Verify contracts
        async function verifyContracts() {
            try {
                // Verify contract bytecode matches expected
                const auctionCode = await provider.getCode(CONFIG.CONTRACTS.AUCTION);
                const erc404Code = await provider.getCode(CONFIG.CONTRACTS.ERC404);
                
                if (auctionCode === '0x' || erc404Code === '0x') {
                    throw new Error('Contracts not deployed on this network');
                }
                
                // Initialize contracts
                erc404Contract = new ethers.Contract(
                    CONFIG.CONTRACTS.ERC404,
                    ERC404_CONTRACT_ABI,
                    signer
                );
                
                console.log('Contracts verified and initialized');
            } catch (error) {
                console.error('Contract verification failed:', error);
                showToast('Contract verification failed. Using demo mode.', 'warning');
            }
        }
        
        // Handle wallet errors
        function handleWalletError(error) {
            if (error.code === 4001) {
                showToast('Connection cancelled', 'error');
            } else if (error.code === -32002) {
                showToast('Please unlock MetaMask', 'error');
            } else {
                showToast('Failed to connect wallet', 'error');
            }
        }
        
        // Check network
        async function checkNetwork() {
            if (!provider) return;
            
            const network = await provider.getNetwork();
            
            if (network.chainId !== BigInt(CONFIG.CHAIN_ID) && !DEMO_MODE) {
                showToast(`Please switch to ${CONFIG.CHAIN_NAME}`, 'warning');
                
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x' + CONFIG.CHAIN_ID.toString(16) }],
                    });
                } catch (error) {
                    if (error.code === 4902) {
                        // Chain not added, add it
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x' + CONFIG.CHAIN_ID.toString(16),
                                chainName: CONFIG.CHAIN_NAME,
                                nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                rpcUrls: [CONFIG.RPC_URL],
                                blockExplorerUrls: [CONFIG.BLOCK_EXPLORER]
                            }]
                        });
                    }
                }
            }
        }
        
        // Handle account changes
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                userAccount = null;
                updateWalletUI();
                showToast('Wallet disconnected', 'error');
            } else if (accounts[0] !== userAccount) {
                userAccount = accounts[0];
                updateWalletUI();
                showToast('Account changed', 'success');
            }
        }
        
        // Update wallet UI
        async function updateWalletUI() {
            const walletButton = document.querySelector('.connect-wallet');
            const balanceDisplay = document.getElementById('token-balance');
            
            if (userAccount) {
                walletButton.classList.add('connected');
                const truncatedAddress = `${userAccount.slice(0, 6)}...${userAccount.slice(-4)}`;
                document.getElementById('wallet-text').textContent = truncatedAddress;
                
                balanceDisplay.style.display = 'block';
                await updateTokenBalance();
            } else {
                walletButton.classList.remove('connected');
                document.getElementById('wallet-text').textContent = 'Connect Wallet';
                balanceDisplay.style.display = 'none';
            }
        }
        
        // Update token balance
        async function updateTokenBalance() {
            if (!userAccount || !erc404Contract) return;
            
            try {
                if (DEMO_MODE) {
                    const balance = Math.floor(Math.random() * 5000);
                    document.getElementById('balance-amount').textContent = balance.toLocaleString();
                } else {
                    const balance = await erc404Contract.balanceOf(userAccount);
                    document.getElementById('balance-amount').textContent = balance.toString();
                }
            } catch (error) {
                console.error('Error fetching balance:', error);
            }
        }
        
        // Secure DOM manipulation for rendering artifacts
        function createArtifactCard(artifact) {
            const card = document.createElement('div');
            card.className = 'artifact-card';
            card.onclick = () => openArtifactModal(artifact.id);
            
            const imageContainer = document.createElement('div');
            imageContainer.className = `artifact-image-container ${artifact.imageOrientation || 'square'}`;
            
            const img = document.createElement('img');
            img.src = artifact.thumbnail || artifact.images[0] || '/assets/images/placeholder.jpg';
            img.alt = SecurityUtils.escapeHtml(artifact.title);
            img.className = 'artifact-image loading';
            img.loading = 'lazy';
            img.onload = function() {
                this.classList.remove('loading');
                this.classList.add('loaded');
            };
            img.onerror = function() {
                this.src = '/assets/images/placeholder.jpg';
            };
            
            imageContainer.appendChild(img);
            card.appendChild(imageContainer);
            
            const info = document.createElement('div');
            info.className = 'artifact-info';
            
            // Create elements safely
            const elements = [
                { tag: 'div', className: 'artifact-lot', text: `LOT ${artifact.lotNumber}` },
                { tag: 'h3', className: 'artifact-title', text: artifact.title },
                { tag: 'p', className: 'artifact-dynasty', html: `${SecurityUtils.escapeHtml(artifact.chinese)}<br>${SecurityUtils.escapeHtml(artifact.dynastyInfo)}` },
                { tag: 'p', className: 'artifact-estimate', text: `Estimate: $${(artifact.estimate.low / 1000000).toFixed(1)}M - $${(artifact.estimate.high / 1000000).toFixed(1)}M` },
                { tag: 'p', className: 'artifact-bid', text: `$${(artifact.currentBid / 1000000).toFixed(1)}M` },
                { tag: 'p', className: 'artifact-estimate', text: `${artifact.bidCount} bids • ${getTimeLeft(artifact.endTime)}` }
            ];
            
            elements.forEach(({ tag, className, text, html }) => {
                const el = document.createElement(tag);
                el.className = className;
                if (html) {
                    el.innerHTML = html;
                } else {
                    el.textContent = text;
                }
                info.appendChild(el);
            });
            
            const erc404Info = document.createElement('div');
            erc404Info.className = 'artifact-erc404';
            erc404Info.innerHTML = `<strong>ERC-404:</strong> ${artifact.fractionalAvailable.toLocaleString()} SHEN available<br>${artifact.tokenHolders} fractional owners`;
            info.appendChild(erc404Info);
            
            card.appendChild(info);
            return card;
        }
        
        // Render artifacts securely
        function renderArtifacts() {
            const grid = document.getElementById('artifacts-grid');
            let filteredArtifacts = artifacts;
            
            // Apply filter
            if (currentFilter !== 'all') {
                filteredArtifacts = artifacts.filter(a => a.dynasty === currentFilter);
            }
            
            // Apply sort
            filteredArtifacts.sort((a, b) => {
                switch(currentSort) {
                    case 'price-high':
                        return b.currentBid - a.currentBid;
                    case 'price-low':
                        return a.currentBid - b.currentBid;
                    case 'ending':
                        return a.endTime - b.endTime;
                    default:
                        return a.lotNumber.localeCompare(b.lotNumber);
                }
            });
            
            // Clear grid
            grid.innerHTML = '';
            
            // Create cards using DOM methods
            filteredArtifacts.forEach(artifact => {
                const card = createArtifactCard(artifact);
                grid.appendChild(card);
            });
        }
        
        // Filter by dynasty
        function filterByDynasty(dynasty) {
            currentFilter = dynasty;
            document.querySelectorAll('.dynasty-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderArtifacts();
        }
        
        // Sort artifacts
        function sortArtifacts(sortBy) {
            currentSort = sortBy;
            renderArtifacts();
        }
        
        // Open artifact modal
        function openArtifactModal(id) {
            selectedArtifact = artifacts.find(a => a.id === id);
            if (!selectedArtifact) return;
            
            currentImageIndex = 0;
            
            // Update modal content safely
            updateModalImage();
            document.getElementById('modal-lot').textContent = `LOT ${selectedArtifact.lotNumber}`;
            document.getElementById('modal-title').textContent = selectedArtifact.title;
            document.getElementById('modal-dynasty').textContent = `${selectedArtifact.chinese} | ${selectedArtifact.dynastyInfo}`;
            document.getElementById('modal-description').textContent = selectedArtifact.description;
            document.getElementById('modal-provenance').textContent = selectedArtifact.provenance;
            document.getElementById('modal-condition').textContent = selectedArtifact.condition;
            document.getElementById('modal-dimensions').textContent = selectedArtifact.dimensions;
            document.getElementById('modal-literature').textContent = selectedArtifact.literature;
            document.getElementById('modal-current-bid').textContent = `$${(selectedArtifact.currentBid / 1000000).toFixed(2)}M`;
            document.getElementById('modal-bid-count').textContent = `${selectedArtifact.bidCount} bids`;
            document.getElementById('min-bid').textContent = (selectedArtifact.currentBid + selectedArtifact.minBidIncrement).toLocaleString();
            document.getElementById('available-tokens').textContent = selectedArtifact.fractionalAvailable.toLocaleString();
            
            // Show optional sections
            if (selectedArtifact.technicalNotes) {
                document.getElementById('technical-notes-section').style.display = 'block';
                document.getElementById('modal-technical-notes').textContent = selectedArtifact.technicalNotes;
            } else {
                document.getElementById('technical-notes-section').style.display = 'none';
            }
            
            if (selectedArtifact.culturalSignificance) {
                document.getElementById('cultural-significance-section').style.display = 'block';
                document.getElementById('modal-cultural-significance').textContent = selectedArtifact.culturalSignificance;
            } else {
                document.getElementById('cultural-significance-section').style.display = 'none';
            }
            
            // Create gallery dots
            createGalleryDots();
            
            // Clear input fields and errors
            document.getElementById('bid-amount').value = '';
            document.getElementById('token-amount').value = '';
            clearInputErrors();
            
            // Estimate gas
            estimateGas();
            
            // Show modal
            document.getElementById('artifact-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // Update modal image
        function updateModalImage() {
            if (!selectedArtifact || !selectedArtifact.images) return;
            
            const modalImage = document.getElementById('modal-image');
            const imageSrc = selectedArtifact.images[currentImageIndex] || '/assets/images/placeholder.jpg';
            
            modalImage.style.opacity = '0';
            setTimeout(() => {
                modalImage.src = imageSrc;
                modalImage.style.opacity = '1';
            }, 200);
        }
        
        // Create gallery dots
        function createGalleryDots() {
            const dotsContainer = document.getElementById('gallery-dots');
            if (!selectedArtifact.images || selectedArtifact.images.length <= 1) {
                dotsContainer.innerHTML = '';
                return;
            }
            
            dotsContainer.innerHTML = '';
            selectedArtifact.images.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.className = `gallery-dot ${index === currentImageIndex ? 'active' : ''}`;
                dot.onclick = () => changeImage(index);
                dotsContainer.appendChild(dot);
            });
        }
        
        // Change image in gallery
        function changeImage(index) {
            currentImageIndex = index;
            updateModalImage();
            
            // Update dots
            document.querySelectorAll('.gallery-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('artifact-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            selectedArtifact = null;
            currentImageIndex = 0;
        }
        
        // Clear input errors
        function clearInputErrors() {
            document.querySelectorAll('.input-error').forEach(error => {
                error.classList.remove('show');
            });
            document.querySelectorAll('.bid-input').forEach(input => {
                input.classList.remove('error');
            });
        }
        
        // Show input error
        function showInputError(inputId, errorId, message) {
            const input = document.getElementById(inputId);
            const error = document.getElementById(errorId);
            
            input.classList.add('error');
            error.textContent = message;
            error.classList.add('show');
        }
        
        // Estimate gas
        async function estimateGas() {
            if (!provider || DEMO_MODE) {
                document.getElementById('gas-estimate').textContent = '~0.001 ETH';
                document.getElementById('confirm-gas').textContent = '~0.001 ETH';
                return;
            }
            
            try {
                const gasPrice = await provider.getFeeData();
                const estimatedGas = 150000n; // Typical ERC-404 transaction
                const gasCost = (gasPrice.gasPrice * estimatedGas) / 10n**18n;
                const formattedGas = (Number(gasCost) / 1000).toFixed(3);
                
                document.getElementById('gas-estimate').textContent = `~${formattedGas} ETH`;
                document.getElementById('confirm-gas').textContent = `~${formattedGas} ETH`;
            } catch (error) {
                console.error('Error estimating gas:', error);
            }
        }
        
        // Place bid with security
        async function placeBidSecure() {
            if (!SecurityUtils.rateLimiter.check('place-bid', 5, 60000)) {
                return;
            }
            
            if (!userAccount) {
                showToast('Please connect your wallet first', 'error');
                return;
            }
            
            const bidInput = document.getElementById('bid-amount');
            const bidAmount = SecurityUtils.sanitizeNumber(bidInput.value);
            const minBid = selectedArtifact.currentBid + selectedArtifact.minBidIncrement;
            
            clearInputErrors();
            
            if (!bidAmount || bidAmount < minBid) {
                showInputError('bid-amount', 'bid-error', `Minimum bid is $${minBid.toLocaleString()}`);
                return;
            }
            
            if (bidAmount > 100000000) { // $100M max
                showInputError('bid-amount', 'bid-error', 'Maximum bid exceeded');
                return;
            }
            
            // Check if transaction is already pending
            if (SecurityUtils.transactionManager.isPending('bid-' + selectedArtifact.id)) {
                showToast('Transaction already in progress', 'warning');
                return;
            }
            
            // Show confirmation
            pendingTransaction = {
                type: 'bid',
                artifact: selectedArtifact,
                amount: bidAmount,
                input: bidInput
            };
            
            showConfirmation('bid', bidAmount);
        }
        
        // Buy tokens with security
        async function buyTokensSecure() {
            if (!SecurityUtils.rateLimiter.check('buy-tokens', 5, 60000)) {
                return;
            }
            
            if (!userAccount) {
                showToast('Please connect your wallet first', 'error');
                return;
            }
            
            const tokenInput = document.getElementById('token-amount');
            const tokenAmount = SecurityUtils.sanitizeNumber(tokenInput.value, 100, 10000);
            
            clearInputErrors();
            
            if (!tokenAmount) {
                showInputError('token-amount', 'token-error', 'Please enter a valid amount (100-10,000)');
                return;
            }
            
            if (tokenAmount > selectedArtifact.fractionalAvailable) {
                showInputError('token-amount', 'token-error', 'Not enough tokens available');
                return;
            }
            
            // Check if transaction is already pending
            if (SecurityUtils.transactionManager.isPending('tokens-' + selectedArtifact.id)) {
                showToast('Transaction already in progress', 'warning');
                return;
            }
            
            const totalCost = tokenAmount * 100; // $100 per SHEN
            
            // Show confirmation
            pendingTransaction = {
                type: 'tokens',
                artifact: selectedArtifact,
                amount: tokenAmount,
                cost: totalCost,
                input: tokenInput
            };
            
            showConfirmation('tokens', tokenAmount, totalCost);
        }
        
        // Show confirmation modal
        function showConfirmation(type, amount, cost) {
            const modal = document.getElementById('confirmation-modal');
            const details = document.getElementById('confirmation-details');
            
            if (type === 'bid') {
                details.innerHTML = `
                    <div class="confirmation-row">
                        <span>Artifact:</span>
                        <span>${SecurityUtils.escapeHtml(pendingTransaction.artifact.title)}</span>
                    </div>
                    <div class="confirmation-row">
                        <span>Your Bid:</span>
                        <span>$${amount.toLocaleString()}</span>
                    </div>
                    <div class="confirmation-row">
                        <span>Total Amount:</span>
                        <span><strong>$${amount.toLocaleString()}</strong></span>
                    </div>
                `;
            } else {
                details.innerHTML = `
                    <div class="confirmation-row">
                        <span>Artifact:</span>
                        <span>${SecurityUtils.escapeHtml(pendingTransaction.artifact.title)}</span>
                    </div>
                    <div class="confirmation-row">
                        <span>SHEN Tokens:</span>
                        <span>${amount.toLocaleString()}</span>
                    </div>
                    <div class="confirmation-row">
                        <span>Price per Token:</span>
                        <span>$100</span>
                    </div>
                    <div class="confirmation-row">
                        <span>Total Cost:</span>
                        <span><strong>$${cost.toLocaleString()}</strong></span>
                    </div>
                `;
            }
            
            modal.style.display = 'flex';
        }
        
        // Close confirmation
        function closeConfirmation() {
            document.getElementById('confirmation-modal').style.display = 'none';
            pendingTransaction = null;
        }
        
        // Execute transaction
        async function executeTransaction() {
            if (!pendingTransaction) return;
            
            const btnConfirm = document.getElementById('btn-confirm-transaction');
            btnConfirm.disabled = true;
            btnConfirm.textContent = 'Processing...';
            btnConfirm.classList.add('processing');
            
            const txId = `${pendingTransaction.type}-${pendingTransaction.artifact.id}`;
            SecurityUtils.transactionManager.setPending(txId, true);
            
            try {
                if (DEMO_MODE) {
                    // Demo mode simulation
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    if (pendingTransaction.type === 'bid') {
                        pendingTransaction.artifact.currentBid = pendingTransaction.amount;
                        pendingTransaction.artifact.bidCount++;
                        
                        showToast(`Demo Mode: Bid of $${pendingTransaction.amount.toLocaleString()} placed successfully!`, 'success');
                        
                        // Update modal
                        document.getElementById('modal-current-bid').textContent = 
                            `$${(pendingTransaction.amount / 1000000).toFixed(2)}M`;
                        document.getElementById('modal-bid-count').textContent = 
                            `${pendingTransaction.artifact.bidCount} bids`;
                    } else {
                        pendingTransaction.artifact.fractionalAvailable -= pendingTransaction.amount;
                        pendingTransaction.artifact.tokenHolders++;
                        
                        showToast(`Demo Mode: Purchased ${pendingTransaction.amount} SHEN tokens!`, 'success');
                        
                        document.getElementById('available-tokens').textContent = 
                            pendingTransaction.artifact.fractionalAvailable.toLocaleString();
                    }
                    
                    pendingTransaction.input.value = '';
                    
                } else {
                    // Real contract interaction
                    let tx;
                    if (pendingTransaction.type === 'bid') {
                        tx = await auctionContract.placeBid(pendingTransaction.artifact.id, {
                            value: ethers.parseUnits(pendingTransaction.amount.toString(), 6)
                        });
                    } else {
                        tx = await erc404Contract.buyTokens(
                            pendingTransaction.artifact.id, 
                            pendingTransaction.amount, 
                            {
                                value: ethers.parseUnits(pendingTransaction.cost.toString(), 6)
                            }
                        );
                    }
                    
                    const receipt = await tx.wait();
                    
                    showToast(`Transaction successful! Hash: ${receipt.hash.slice(0, 10)}...`, 'success');
                    
                    // Update UI
                    if (pendingTransaction.type === 'bid') {
                        pendingTransaction.artifact.currentBid = pendingTransaction.amount;
                        pendingTransaction.artifact.bidCount++;
                    } else {
                        pendingTransaction.artifact.fractionalAvailable -= pendingTransaction.amount;
                        pendingTransaction.artifact.tokenHolders++;
                        await updateTokenBalance();
                    }
                }
                
                renderArtifacts();
                updateStats();
                closeConfirmation();
                
            } catch (error) {
                console.error('Transaction error:', error);
                showToast(getErrorMessage(error), 'error');
            } finally {
                SecurityUtils.transactionManager.setPending(txId, false);
                btnConfirm.disabled = false;
                btnConfirm.textContent = 'Confirm Transaction';
                btnConfirm.classList.remove('processing');
            }
        }
        
        // Get user-friendly error message
        function getErrorMessage(error) {
            if (error.code === 'ACTION_REJECTED') {
                return 'Transaction cancelled';
            } else if (error.code === 'INSUFFICIENT_FUNDS') {
                return 'Insufficient funds in wallet';
            } else if (error.code === 'NETWORK_ERROR') {
                return 'Network error. Please try again.';
            } else if (error.message && error.message.includes('gas')) {
                return 'Transaction failed. Gas estimation error.';
            }
            return 'Transaction failed. Please try again.';
        }
        
        // Update statistics
        function updateStats() {
            document.getElementById('total-lots').textContent = artifacts.length;
            const totalBids = artifacts.reduce((sum, a) => sum + a.bidCount, 0);
            document.getElementById('total-bids').textContent = totalBids;
            const totalValue = artifacts.reduce((sum, a) => sum + a.currentBid, 0);
            document.getElementById('total-value').textContent = `$${(totalValue / 1000000).toFixed(1)}M`;
        }
        
        // Get time left for auction
        function getTimeLeft(endTime) {
            const now = Date.now();
            const diff = endTime - now;
            
            if (diff <= 0) return 'Ended';
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (days > 0) return `${days}d ${hours}h`;
            if (hours > 0) return `${hours}h ${minutes}m`;
            return `${minutes}m`;
        }
        
        // Start timers
        function startTimers() {
            setInterval(() => {
                // Update time left in grid
                const cards = document.querySelectorAll('.artifact-card');
                cards.forEach((card, index) => {
                    const artifact = artifacts[index];
                    const timeElement = card.querySelector('.artifact-estimate:last-of-type');
                    if (timeElement && artifact) {
                        timeElement.textContent = `${artifact.bidCount} bids • ${getTimeLeft(artifact.endTime)}`;
                    }
                });
            }, 60000); // Update every minute
        }
        
        // Enhanced toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = toast.querySelector('.toast-message') || toast;
            const toastIcon = toast.querySelector('.toast-icon');
            
            // Set icon based on type
            const icons = {
                success: '✓',
                error: '✕',
                warning: '⚠',
                info: 'ℹ'
            };
            
            if (toastIcon) {
                toastIcon.textContent = icons[type] || icons.info;
            }
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            // Auto-hide
            setTimeout(() => {
                toast.classList.remove('show');
            }, type === 'error' ? 5000 : 4000);
        }
        
        // Scroll functions
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function scrollToAuctions() {
            document.getElementById('auctions').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Toggle mobile menu
        function toggleMobileMenu() {
            showToast('Mobile menu coming soon', 'info');
        }
        
        // Modal close on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('artifact-modal');
            const confirmModal = document.getElementById('confirmation-modal');
            
            if (event.target === modal) {
                closeModal();
            } else if (event.target === confirmModal) {
                closeConfirmation();
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (document.getElementById('confirmation-modal').style.display === 'flex') {
                    closeConfirmation();
                } else if (selectedArtifact) {
                    closeModal();
                }
            }
            
            // Arrow keys for image gallery
            if (selectedArtifact && selectedArtifact.images && selectedArtifact.images.length > 1) {
                if (e.key === 'ArrowLeft' && currentImageIndex > 0) {
                    changeImage(currentImageIndex - 1);
                } else if (e.key === 'ArrowRight' && currentImageIndex < selectedArtifact.images.length - 1) {
                    changeImage(currentImageIndex + 1);
                }
            }
        });
        
        // Handle resize events
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                renderArtifacts();
            }, 250);
        });
        
        // Initialize on load
        window.addEventListener('load', init);
        
        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            if (window.ethereum) {
                window.ethereum.removeListener('accountsChanged', handleAccountsChanged);
            }
        });
        
        // Generate runtime nonce for CSP (in production, this would be server-generated)
        document.addEventListener('DOMContentLoaded', function() {
            // Replace RUNTIME_NONCE with actual nonce in production
            const metaCSP = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (metaCSP) {
                const nonce = Math.random().toString(36).substring(2, 15);
                metaCSP.content = metaCSP.content.replace(/RUNTIME_NONCE/g, nonce);
                
                // Add nonce to inline scripts
                document.querySelectorAll('script:not([src])').forEach(script => {
                    script.setAttribute('nonce', nonce);
                });
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shenbury ç¥žå ¡ | Chinese Imperial Ceramics - SHEN Token Presale Live</title>
    
    <!-- Same head content as before -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- TronWeb -->
    <script src="https://cdn.jsdelivr.net/npm/tronweb@5.3.2/dist/TronWeb.js"></script>
    
    <!-- Data Service -->
    <script src="/js/data-service.js"></script>
    
    <style>
        /* Previous styles remain the same, adding these updates */
        
        .presale-notice {
            background: linear-gradient(135deg, #c9302c 0%, #a02622 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 0.875rem;
            position: sticky;
            top: 80px;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .presale-notice a {
            color: white;
            font-weight: 500;
            text-decoration: underline;
            margin-left: 1rem;
        }
        
        .artifact-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-radius: 100px;
            margin-bottom: 0.5rem;
        }
        
        .artifact-status.upcoming {
            background: #f0f0f0;
            color: #666;
        }
        
        .artifact-status.live {
            background: #28a745;
            color: white;
        }
        
        .reserve-price {
            font-size: 1rem;
            color: #c9302c;
            font-weight: 500;
            margin: 0.5rem 0;
        }
        
        .auction-date {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .fractional-notice {
            background: #f8f8f8;
            padding: 0.5rem;
            font-size: 0.75rem;
            text-align: center;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        
        .hero-presale {
            background: rgba(201, 48, 44, 0.1);
            padding: 1rem 2rem;
            border-radius: 100px;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        /* Remove bidding UI elements */
        .bid-options,
        .current-bid-info {
            display: none;
        }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="loader"></div>
    </div>

    <!-- Header remains the same -->
    <header>
        <nav>
            <div class="logo" onclick="window.location.href='/'">
                <div class="logo-text">
                    <div class="logo-chinese">ç¥žå ¡</div>
                    <div class="logo-english">Shenbury</div>
                </div>
                <div class="logo-tagline">The Art of Provenance</div>
            </div>
            <div class="nav-center">
                <a href="/" class="active">Collection</a>
                <a href="/presale.html">Presale</a>
                <a href="#about">About</a>
                <a href="#contact">Contact</a>
            </div>
            <div class="nav-right">
                <div class="wallet-info">
                    <div class="wallet-balance" id="wallet-balance" style="display: none;">
                        <span id="shen-balance">0</span> SHEN
                    </div>
                    <button class="connect-wallet" onclick="connectWallet()">
                        <span id="wallet-text">Connect TronLink</span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Presale Notice Bar -->
    <div class="presale-notice">
        ðŸ”¥ SHEN Token Presale is LIVE! Get up to 30% bonus on early purchases.
        <a href="/presale.html">Join Presale â†’</a>
    </div>

    <!-- Hero Section Updated -->
    <section class="hero">
        <div class="hero-content">
            <div class="hero-presale">
                <span style="font-weight: 500;">SHEN Token Presale Live</span>
            </div>
            <h1>Exceptional Chinese Art</h1>
            <p>Museum-Quality Ceramics from Song, Yuan & Ming Dynasties</p>
            <div class="hero-buttons">
                <button class="hero-cta primary" onclick="window.location.href='/presale.html'">
                    Join Presale
                </button>
                <button class="hero-cta secondary" onclick="scrollToCollection()">
                    View Collection
                </button>
            </div>
        </div>
    </section>

    <!-- Collection Header -->
    <div class="auction-header" id="collection">
        <h2>Upcoming Collection</h2>
        <div class="auction-stats">
            <div class="stat-item">
                <span class="stat-value" id="total-pieces">5</span>
                <span>Museum Pieces</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="total-value">$147.5M</span>
                <span>Total Reserve Value</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">Q1 2025</span>
                <span>First Auction</span>
            </div>
        </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="dynasty-filters">
            <button class="dynasty-filter active" onclick="filterByDynasty('all')">All Dynasties</button>
            <button class="dynasty-filter" onclick="filterByDynasty('song')">Song Dynasty</button>
            <button class="dynasty-filter" onclick="filterByDynasty('yuan')">Yuan Dynasty</button>
            <button class="dynasty-filter" onclick="filterByDynasty('ming')">Ming Dynasty</button>
        </div>
        <div class="sort-controls">
            <span>Sort by:</span>
            <select class="sort-select" onchange="sortArtifacts(this.value)">
                <option value="lot">Lot Number</option>
                <option value="value">Reserve Value</option>
                <option value="date">Auction Date</option>
            </select>
        </div>
    </div>

    <!-- Artifacts Grid -->
    <div class="artifacts-grid" id="artifacts-grid">
        <!-- Dynamically populated -->
    </div>

    <!-- Artifact Detail Modal (Simplified) -->
    <div class="modal" id="artifact-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div class="modal-body">
                <div class="modal-image-section">
                    <img src="" alt="" class="modal-image" id="modal-image">
                </div>
                <div class="modal-info-section">
                    <div class="modal-lot-number" id="modal-lot">LOT 000</div>
                    <h2 class="modal-title" id="modal-title"></h2>
                    <p class="modal-dynasty" id="modal-dynasty"></p>
                    <p class="modal-description" id="modal-description"></p>
                    
                    <div class="detail-sections">
                        <div class="detail-section">
                            <h4>Reserve Price</h4>
                            <p class="reserve-price" id="modal-reserve"></p>
                        </div>
                        <div class="detail-section">
                            <h4>Auction Date</h4>
                            <p id="modal-auction-date"></p>
                        </div>
                        <div class="detail-section">
                            <h4>Fractional Ownership</h4>
                            <p>This artifact will be available for fractional ownership through SHEN tokens after the auction.</p>
                            <a href="/presale.html" class="btn-link">Learn more about SHEN tokens â†’</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Footer remains the same -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-logo">
                    <div class="logo-text">
                        <div class="logo-chinese">ç¥žå ¡</div>
                        <div class="logo-english">Shenbury</div>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.875rem; margin-top: 0.5rem;">The Art of Provenance</p>
                </div>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <a href="/presale.html">SHEN Presale</a>
                <a href="#collection">Collection</a>
                <a href="#about">About</a>
                <a href="#contact">Contact</a>
            </div>
            <div class="footer-section">
                <h4>Resources</h4>
                <a href="#">Whitepaper</a>
                <a href="#">Token Economics</a>
                <a href="#">Smart Contract</a>
                <a href="#">FAQ</a>
            </div>
            <div class="footer-section">
                <h4>Connect</h4>
                <a href="#">Telegram</a>
                <a href="#">Twitter</a>
                <a href="#">Discord</a>
                <a href="#">Medium</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Shenbury ç¥žå ¡. All rights reserved. | TRC-404 Powered by TRON</p>
        </div>
    </footer>

    <script>
        // Global variables
        let tronWeb = null;
        let userAddress = null;
        let artifacts = [];
        let currentFilter = 'all';
        let currentSort = 'lot';
        let selectedArtifact = null;
        
        // Initialize
        async function init() {
            // Initialize data service
            await window.shenburyData.initialize();
            
            // Load artifacts
            artifacts = await window.shenburyData.getArtifactData();
            
            // Render UI
            renderArtifacts();
            updateStats();
            
            // Check wallet connection
            checkWalletConnection();
            
            // Hide loading
            hideLoading();
        }
        
        // Hide loading screen
        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 500);
        }
        
        // Check if wallet is already connected
        async function checkWalletConnection() {
            if (window.tronWeb && window.tronWeb.ready) {
                tronWeb = window.tronWeb;
                userAddress = tronWeb.defaultAddress.base58;
                updateWalletUI();
            }
        }
        
        // Connect wallet
        async function connectWallet() {
            if (!window.tronLink) {
                showToast('Please install TronLink wallet', 'error');
                window.open('https://www.tronlink.org/', '_blank');
                return;
            }
            
            try {
                const res = await window.tronLink.request({ method: 'tron_requestAccounts' });
                
                if (res.code === 200) {
                    tronWeb = window.tronWeb;
                    userAddress = tronWeb.defaultAddress.base58;
                    updateWalletUI();
                    showToast('Wallet connected!', 'success');
                }
            } catch (error) {
                console.error('Connection error:', error);
                showToast('Failed to connect wallet', 'error');
            }
        }
        
        // Update wallet UI
        async function updateWalletUI() {
            const walletButton = document.querySelector('.connect-wallet');
            const balanceDisplay = document.getElementById('wallet-balance');
            
            if (userAddress) {
                walletButton.textContent = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
                
                // Get SHEN balance
                const balance = await window.shenburyData.getUserBalance(userAddress);
                document.getElementById('shen-balance').textContent = 
                    window.shenburyData.formatNumber(balance, 0);
                
                balanceDisplay.style.display = 'flex';
            }
        }
        
        // Render artifacts
        function renderArtifacts() {
            const grid = document.getElementById('artifacts-grid');
            let filteredArtifacts = artifacts;
            
            // Apply filter
            if (currentFilter !== 'all') {
                filteredArtifacts = artifacts.filter(a => a.dynasty === currentFilter);
            }
            
            // Apply sort
            filteredArtifacts.sort((a, b) => {
                switch(currentSort) {
                    case 'value':
                        return b.reservePrice - a.reservePrice;
                    case 'date':
                        return a.auctionDate.localeCompare(b.auctionDate);
                    default:
                        return a.lotNumber.localeCompare(b.lotNumber);
                }
            });
            
            grid.innerHTML = filteredArtifacts.map(artifact => `
                <div class="artifact-card" onclick="openArtifactModal(${artifact.id})">
                    <div class="artifact-image-container">
                        <img src="${artifact.images[0]}" 
                             alt="${artifact.title}" 
                             class="artifact-image" 
                             loading="lazy">
                    </div>
                    <div class="artifact-info">
                        <div class="artifact-status ${artifact.status}">${artifact.status}</div>
                        <div class="artifact-lot">LOT ${artifact.lotNumber}</div>
                        <h3 class="artifact-title">${artifact.title}</h3>
                        <p class="artifact-dynasty">${artifact.chinese}<br>${artifact.dynastyInfo}</p>
                        <p class="reserve-price">Reserve: ${window.shenburyData.formatCurrency(artifact.reservePrice)}</p>
                        <p class="artifact-estimate">Estimate: ${artifact.estimateRange}</p>
                        <p class="auction-date">Auction: ${artifact.auctionDate}</p>
                        ${artifact.fractionalAvailable ? 
                            '<div class="fractional-notice">Fractional ownership available via SHEN tokens</div>' : 
                            ''
                        }
                    </div>
                </div>
            `).join('');
        }
        
        // Filter by dynasty
        function filterByDynasty(dynasty) {
            currentFilter = dynasty;
            document.querySelectorAll('.dynasty-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderArtifacts();
        }
        
        // Sort artifacts
        function sortArtifacts(sortBy) {
            currentSort = sortBy;
            renderArtifacts();
        }
        
        // Open artifact modal
        function openArtifactModal(id) {
            selectedArtifact = artifacts.find(a => a.id === id);
            if (!selectedArtifact) return;
            
            // Update modal content
            document.getElementById('modal-image').src = selectedArtifact.images[0];
            document.getElementById('modal-lot').textContent = `LOT ${selectedArtifact.lotNumber}`;
            document.getElementById('modal-title').textContent = selectedArtifact.title;
            document.getElementById('modal-dynasty').textContent = `${selectedArtifact.chinese} | ${selectedArtifact.dynastyInfo}`;
            document.getElementById('modal-description').textContent = selectedArtifact.description;
            document.getElementById('modal-reserve').textContent = window.shenburyData.formatCurrency(selectedArtifact.reservePrice);
            document.getElementById('modal-auction-date').textContent = selectedArtifact.auctionDate;
            
            // Show modal
            document.getElementById('artifact-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('artifact-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            selectedArtifact = null;
        }
        
        // Update stats
        function updateStats() {
            const totalValue = artifacts.reduce((sum, a) => sum + a.reservePrice, 0);
            document.getElementById('total-value').textContent = 
                window.shenburyData.formatCurrency(totalValue);
        }
        
        // Show toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }
        
        // Scroll to collection
        function scrollToCollection() {
            document.getElementById('collection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Modal close on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('artifact-modal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // Initialize on load
        window.addEventListener('load', init);
        
        // Listen for TronLink events
        window.addEventListener('message', function (e) {
            if (e.data.message && e.data.message.action === 'accountsChanged') {
                location.reload();
            }
        });
    </script>
</body>
</html>
